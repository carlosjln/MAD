/*
 * MAD
 * Modular Application Development
 *
 * https://github.com/carlosjln/mad
 * https://github.com/carlosjln/mad-nodejs
 * https://github.com/carlosjln/mad-examples
 *
 * Author: Carlos J. Lopez
 * https://github.com/carlosjln
 */
String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),function(t){function e(){}function n(){return o}var r,o=(Array.prototype.splice,{}),c=Object.prototype.toString,i=function(){function t(t){var e=this;e.module_id=t.id,e.templates={},e.styles={},e.components={}}function n(t,e){var n,r=document.head||document.getElementsByTagName("head")[0];for(var o in e)n=(e[o]||"").trim(),n&&e.hasOwnProperty(o)&&(style=document.createElement("style"),style.setAttribute("type","text/css"),style.styleSheet?style.styleSheet.cssText=n:style.insertBefore(document.createTextNode(n),null),r.insertBefore(style,null),t[o]=style)}function r(t,e){var n,r;for(r in e)if(n=e[r],n&&"string"==typeof n&&e.hasOwnProperty(r))try{t[r]=new Function("return ("+n+");")()}catch(t){throw t}}return t.prototype={constructor:t,update:function(t){if("[object Object]"===c.call(t)){var o=this,i=e.tools.copy;i(t.templates,o.templates,!0),n(o.styles,t.styles),r(o.components,t.components)}},get:function(t,n){var r=this,o="";for(var c in t)t.hasOwnProperty(c)&&(o+=(o?"&":"")+encodeURIComponent(c)+"="+encodeURIComponent(t[c].join("|")));e.request({url:"mad/module/"+r.module_id+"/resources",data:o,on_success:function(e){if(r.update(e.resources),"function"==typeof n)try{n.call(t)}catch(t){throw t}}})}},t}(),u=function(){function t(t){if("string"!=typeof t)throw"The module [id] must be a string.";var e=this;e.id=t,e.resources=new i(e)}return t.prototype={constructor:t,initialize:function(){}},t.initialize=function(t){var e=t.id,n=t.source,o=t.resources;if(e&&n){var c=new u(e);try{new Function("return ("+n+");")().call(c,r),c.resources.update(o),c.initialize()}catch(t){}return c}},t}(),a=function(){function t(t,o,i){var u={module_id:t,callback:o,data:i};e.request({url:"mad/module/"+t,context:u,before_request:n,on_success:r,on_error:c})}function n(){console.log("Requesting module: ",this.module_id)}function r(t){if(!t)return console.log("Exception: Module could not be loaded.");if(t.exception)return console.log("Exception: "+(t.exception||"Module could not be loaded."));var e=this,n=e.module_id,r=u.initialize(t);if(r){o[n]=r;var c=e.data,a=c instanceof Array?c:[c];void 0==c&&(a=void 0),(this.callback||i).apply(r,a)}}function c(t){throw t}function i(){}return t}();n.get=function(t,e,n){var r=o[t],i=e,u=n;return"[object Function]"!==c.call(e)&&(i=null,u=e),r&&i?i.call(r,u):void a(t,i,u)},r=u.initialize({id:"shared",source:"function shared() {return false;}"}),e.modules=n,e.version="0.0.1",t.MAD=e}(window),function(t,e,n){function r(t){if(this instanceof r==!1)return new r(t);var e,n,i=this,u=i.transport=c();for(var a in t)e=o(i[a]),n=t[a],!t.hasOwnProperty(a)||"undefined"!==e&&e!==o(n)||(i[a]=n);var s=i.context||i,l=(i.method||"get").toUpperCase(),f=i.url,d=i.data;u.onreadystatechange=function(){i.on_ready_state_change.call(i)},u.open(l,f,!0),"POST"===l?u.setRequestHeader("Content-type","application/x-www-form-urlencoded"):d&&(f=f+(f.indexOf("?")>-1?"&":"?")+d,d=null),i.before_request.call(s,i,t),u.send(d)}var o=t.tools.get_type,c=e.XMLHttpRequest?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};r.prototype={constructor:r,url:"",method:"GET",before_request:function(t,e){},on_complete:function(t){},on_success:function(t){},on_error:function(t){},on_ready_state_change:function(t){var e,n,r=this,o=r.transport,c=o.readyState,i=r.context||r;if(4!==c)return null;try{e=o.status}catch(t){return null}if(200!==e)return null;var u,a=o.responseText;try{n=new Function("return ("+a+")")(),r.on_success.call(i,n)}catch(t){u=t,r.on_error.call(i,t)}r.on_complete.call(i,u,n)}},t.request=r}(MAD,window,document),function(t){function e(t,n,r){var o,c,u=i(t);if(r=r===!0,"date"===u)return n=new Date,n.setTime(t.getTime()),n;if("array"===u&&r===!1){var a=t.length;for(n=void 0===n?[]:n;a--;)n[a]=e(t[a],n[a],r);return n}if("object"===u){n=void 0===n?{}:n;for(var s in t)t.hasOwnProperty(s)&&(o=t[s],c=n[s],n[s]=e(o,c,r));return n}return r&&void 0!==n?n:t}function n(){for(var t=arguments,n=t.length,r={},o=0;o<n;o++)e(t[o],r);return r}function r(t,e){for(var n,r=t.length,o=0,c=[];o<r;o++)n=t[o],e(n)&&(c[c.length]=n);return c}function o(t){for(var e,n,r,o,i,a,s,l=u,f=c(t),d=f.length,p=0,h="";p<d;)e=f.charCodeAt(p++),n=f.charCodeAt(p++),r=f.charCodeAt(p++),o=e>>2,i=(3&e)<<4|n>>4,a=(15&n)<<2|r>>6,s=63&r,isNaN(n)?a=s=64:isNaN(r)&&(s=64),h=h+l.charAt(o)+l.charAt(i)+l.charAt(a)+l.charAt(s);return h}function c(t){for(var e,n=t.replace(/\r\n/g,"\n"),r=n.length,o=0,c="";r--;)e=n.charCodeAt(o++),e<128?c+=String.fromCharCode(e):e>127&&e<2048?(c+=String.fromCharCode(e>>6|192),c+=String.fromCharCode(63&e|128)):(c+=String.fromCharCode(e>>12|224),c+=String.fromCharCode(e>>6&63|128),c+=String.fromCharCode(63&e|128));return c}var i=function(){function t(t){var r=typeof t;return null===t?"null":"object"===r||"function"===r?e[n.call(t)]||"object":r}var e={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object","[object Error]":"error"},n=e.toString;return t}(),u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.tools={get_type:i,copy:e,merge:n,filter:r,encode_base64:o,encode_utf8:c}}(MAD);